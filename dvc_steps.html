

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>DVC Configuration Steps &mdash; iDVC  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Saving &amp; Exporting" href="saving.html" />
    <link rel="prev" title="Datasets &amp; Visualisation" href="viewer.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> iDVC
          

          
            
            <img src="_static/DVCIconSquare.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="viewer.html">Datasets &amp; Visualisation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">DVC Configuration Steps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#manual-registration">Manual Registration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-point-0-location">The Point 0 Location</a></li>
<li class="toctree-l3"><a class="reference internal" href="#registering-the-images">Registering the Images</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mask">Mask</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-mask">Creating a mask</a></li>
<li class="toctree-l3"><a class="reference internal" href="#saving-and-loading-a-mask">Saving and Loading a mask</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#point-cloud">Point Cloud</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-point-cloud">Creating a point cloud</a></li>
<li class="toctree-l3"><a class="reference internal" href="#saving-and-loading-a-point-cloud">Saving and Loading a point cloud</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-dvc-analysis">Running the DVC Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#run-progress">Run Progress</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="saving.html">Saving &amp; Exporting</a></li>
<li class="toctree-l1"><a class="reference internal" href="results.html">DVC Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="executable.html">DVC Executable</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">iDVC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>DVC Configuration Steps</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/dvc_steps.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="dvc-configuration-steps">
<h1>DVC Configuration Steps<a class="headerlink" href="#dvc-configuration-steps" title="Permalink to this headline">¶</a></h1>
<p>Each panel contains a different step in the DVC configuration process.
When moving between each panel, the Help section is updated. Additional help can be viewed by hovering the mouse over some of the buttons and labels on the interface.</p>
<div class="section" id="manual-registration">
<h2>Manual Registration<a class="headerlink" href="#manual-registration" title="Permalink to this headline">¶</a></h2>
<p>The first step of the DVC analysis is to line up the reference and correlate images. The rigid body translation between the images will be input to the DVC analysis code. Go to the <strong>Manual Registration</strong> tab to get started with this.</p>
<div class="section" id="the-point-0-location">
<h3>The Point 0 Location<a class="headerlink" href="#the-point-0-location" title="Permalink to this headline">¶</a></h3>
<p>First you will need to click on <strong>Select point 0</strong>. This will allow you to press shift and left click on a point in the image. Then change the size of the registration box.
If you scroll through slices of the image, clicking <strong>Center on Point 0</strong> will return you to the slice where point 0 is.
You should try to select point 0 to be at the position you would like to start your DVC analysis from. Later when you select your mask, if your point 0 lies within the mask then when you generate a point cloud, it will guarantee that a point lies at the location of point 0. Then this will be used as the global starting point in the DVC analysis, as well as the reference point for the translation.
Otherwise, a random point in the cloud will be selected to begin with.</p>
</div>
<div class="section" id="registering-the-images">
<h3>Registering the Images<a class="headerlink" href="#registering-the-images" title="Permalink to this headline">¶</a></h3>
<p>You can set an initial translation if you already know some information about how the images are translated relative to each other.</p>
<p>When you click <strong>Start Registration</strong> this will crop the image to the size of the reference box you chose, centred on the point 0. It will do the same for the correlate image, and then it will subtract one image from the other, and display that on the viewer. It does this for the original images, not the down-sampled versions.
If you were to load two identical images, then the subtraction would result in nothing, so you would just see a black square. The idea is that to register the images, you need to align them such that the subtraction results in as uniform an image as possible.
If you have set an initial translation then the images will start off being translated relative to each other accordingly.</p>
<p>You can then move the two images relative to each other by using the keys: j, n, b and m.
You can also still change the orientation using the x, y and z keys, and scroll through the image slices.</p>
<p>Here is an example of what an image registration would look like as you begin to align the images – you can see it becomes more grey where you have a good overlap.</p>
<a class="reference internal image-reference" href="_images/registration_example_0.png"><img alt="_images/registration_example_0.png" src="_images/registration_example_0.png" style="width: 49%;" /></a>
<a class="reference internal image-reference" href="_images/registration_example_1.png"><img alt="_images/registration_example_1.png" src="_images/registration_example_1.png" style="width: 49%;" /></a>
<p><span class="raw-html"><br /></span></p>
<p>Once you are satisfied with the registration, click <strong>Confirm Registration</strong> to save the translation. This will be provided to the DVC analysis code later on.
Then move on to the <strong>Mask</strong> tab.</p>
</div>
</div>
<div class="section" id="mask">
<h2>Mask<a class="headerlink" href="#mask" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-a-mask">
<h3>Creating a mask<a class="headerlink" href="#creating-a-mask" title="Permalink to this headline">¶</a></h3>
<p>A mask needs to be created to dictate where the point cloud will lie.
To draw a mask, click on the 2D viewer and then press <strong>t</strong>.
You can then trace a region freehand.</p>
<p>To extend the mask above and below the current slice, you may adjust the <strong>Slices Above</strong> and <strong>Slices Below</strong> settings,
before clicking <strong>create mask</strong>.
The <strong>Slices Above</strong> and <strong>Slices Below</strong> are in the coordinate system of the down-sampled image (if your image has been down-sampled).</p>
<p>If you would like your mask to cover more than one area, or you would like to increase the area of the mask, tick the <strong>Extend Mask</strong> checkbox.
Then you can draw another region and press <strong>Extend Mask</strong> to extend the mask to this region as well.</p>
</div>
<div class="section" id="saving-and-loading-a-mask">
<h3>Saving and Loading a mask<a class="headerlink" href="#saving-and-loading-a-mask" title="Permalink to this headline">¶</a></h3>
<p>The most recent mask you have created will automatically be saved, but if you would like to create a new mask, you will be prompted to then save the previous one, otherwise it will be discarded.</p>
<p>The names of all of the masks you have saved will appear in a dropdown list. You can select one from here and reload it.</p>
<p>Note that the mask is created in the coordinate system of the down-sampled image, so if you change the down-sampling level, you may not be able to reload a mask you have previously generated.
Alternatively, you may load a mask from a file you have saved. This must be an uncompressed metaimage file, with the extension .mha.
Once you are satisfied with the mask, move on to the <strong>Point Cloud</strong> panel.</p>
</div>
</div>
<div class="section" id="point-cloud">
<h2>Point Cloud<a class="headerlink" href="#point-cloud" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-a-point-cloud">
<h3>Creating a point cloud<a class="headerlink" href="#creating-a-point-cloud" title="Permalink to this headline">¶</a></h3>
<p>First of all, set a <strong>size</strong> for the subvolumes in the point cloud.
This is the diameter of a spherical subvolume region, or the side length of a cubic one.</p>
<img alt="_images/pointcloud_panel.png" src="_images/pointcloud_panel.png" />
<p><span class="raw-html"><br /></span></p>
<p>If you have ticked the option to <strong>display the subvolume preview</strong>, then it will display a preview of the size of each subvolume,
centred on the location of the reference point 0.</p>
<p>If you select a <strong>2D</strong> point cloud, then the point cloud will only be created on the currently displayed slice of the image.
A <strong>3D</strong> point cloud will be created across the entire extent of the mask.</p>
<p>The overlap is the percentage overlap of the subvolume regions.
You can also set a rotation of the subvolumes in degrees, relative to any of the three axes.</p>
<p>You may choose to <strong>erode</strong> the mask.
Without doing this, although all of the points will lie within the mask, areas of some of the subvolumes may lie outside of this.
Eroding the mask will help to ensure the entirety of all of the subvolume regions lies within the mask.
Be aware that this is quite a time consuming process.
You may also adjust the multiplier on the erosion, which will change how heavily this erosion process takes place – you may decrease the multiplier if it does not matter to you if some subvolumes are partially outside of the mask.</p>
<p>The <strong>display subvolume regions</strong> option allows you to turn on/off viewing the subvolumes, but the points themselves will still be displayed.
The display registration region toggles on/off the view of the registration box centred on point 0.</p>
<img alt="_images/3D_pointcloud.png" src="_images/3D_pointcloud.png" />
<p><span class="raw-html"><br /></span></p>
</div>
<div class="section" id="saving-and-loading-a-point-cloud">
<h3>Saving and Loading a point cloud<a class="headerlink" href="#saving-and-loading-a-point-cloud" title="Permalink to this headline">¶</a></h3>
<p>The most recent point cloud you have created will automatically be saved, but if you would like to create a new point cloud, you will be prompted to then save the previous one, otherwise it will be discarded.
The names of all of the point clouds you have saved to the current session will appear in a dropdown list.
You can select one from here and reload it.</p>
<p>Alternatively, you may load a point cloud from a file you have saved.
This must be a tab-delimited text file with the point number in the first column, followed by the x, y and z coordinates of each point.</p>
<p>An example is shown below. The first point in the file will be used as the starting point for the DVC analysis.
Note that you may use non-integer coordinates.</p>
<img alt="_images/pointcloud_txt_example.png" src="_images/pointcloud_txt_example.png" />
<p><span class="raw-html"><br /></span></p>
<p>Note that the point cloud is in the coordinate system of the original image, and is not affected by the down-sampling, it is displayed at the true location of the points.
Once you are happy with your point cloud, you can move on to the <strong>Run DVC</strong> panel.</p>
</div>
</div>
<div class="section" id="running-the-dvc-analysis">
<h2>Running the DVC Analysis<a class="headerlink" href="#running-the-dvc-analysis" title="Permalink to this headline">¶</a></h2>
<p>First, set a name for your run.
This is how the run will be saved, and you will need to refer to this name later when you would like to view the results.
The settings you can change for your run are as follows:</p>
<img alt="_images/run_dvc_panel.png" src="_images/run_dvc_panel.png" />
<p><span class="raw-html"><br /></span></p>
<p><strong>Points in run</strong> - the number of points you would like to perform the run on. This will automatically start off being set to the total number of points in the cloud you have created, but you may wish to run with less points to begin with, as a test for instance. If you choose less points than the total number in the cloud, and your reference point 0 lies within your point cloud, the points will be selected starting with point 0 and working outwards from there.</p>
<p><strong>Maximum displacement</strong> - defines the maximum displacement expected within the reference image volume. This is a very important parameter used for search process control and memory allocation. Set to a reasonable value just greater than the actual sample maximum displacement. Be cautious: large displacements make the search process slower and less reliable. It is best to reduce large rigid body displacements through image volume manipulation. Future code development will introduce methods for better management of large displacements.
<code class="docutils literal notranslate"><span class="pre">Suitable</span> <span class="pre">values:</span> <span class="pre">1</span> <span class="pre">-&gt;</span> <span class="pre">smallest</span> <span class="pre">dimension</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">image</span> <span class="pre">volumes</span></code></p>
<p><strong>Number of degrees of freedom</strong> - defines the degree-of-freedom set for the final stage of the search. The actual search process introduces degrees-of-freedom in stages up to this value. Translation only suffices for a quick, preliminary investigation. Adding rotation will significantly improve displacement accuracy in most cases. Reserve strain degrees-of-freedom for cases when the highest precision is required.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">3</span></code> = translation only</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">6</span></code>  = translation plus rotation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">12</span></code> = translation, rotation and strain</p></li>
</ul>
<p><strong>Objective function</strong> - defines the objective function template matching form. See B. Pan, Equivalence of Digital Image Correlation Criteria for Pattern Matching, 2010. Functions become increasingly expensive and more robust as you progress from sad to znssd. Minimizing squared-difference and maximizing cross-correlation are functionally equivalent.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sad</span></code> = sum of absolute differences</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ssd</span></code>  = sum of squared differences</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zssd</span></code>  = intensity offset insensitive sum of squared differences (value not normalized)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nssd</span></code>  = intensity range insensitive sum of squared differences (0.0 = perfect match, 1.0 = max value)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">znssd</span></code>  = intensity offset and range insensitive sum of squared differences (0.0 = perfect match, 1.0 = max value)</p></li>
</ul>
<p>Notes on objective function values:</p>
<ul class="simple">
<li><p>The normalized quantities nssd and znssd are preferred, as quality of match can be assessed.</p></li>
<li><p>The natural range of nssd is [0.0 to 2.0], and of znssd is [0.0 to 4.0].</p></li>
<li><p>Both are scaled for output into the [0.0 to 1.0] range for ease of comparison.</p></li>
</ul>
<p><strong>Interpolation type</strong> - Defines the interpolation method used during template matching. Options: nearest, trilinear, tricubic.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Trilinear</span></code> is significantly faster, but with known template matching artefacts.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Trilinear</span></code> is most useful for tuning other search parameters during preliminary runs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Tricubic</span></code> is computationally expensive, but is the choice if strain is of interest.</p></li>
</ul>
<p><strong>Sampling Points in subvolume</strong> - Defines the number of points within each subvolume (max is 50000). In this code, subvolume point locations are NOT voxel-centred and the number is INDEPENDENT of subvolume size. Interpolation within the reference image volume is used to establish templates with arbitrary point locations.</p>
<ul class="simple">
<li><p>For cubes a uniform grid of sampling points is generated.</p></li>
<li><p>For spheres, the sampling points are randomly distributed within the subvolume.</p></li>
</ul>
<p>This parameter has a strong effect on computation time, so be careful.
You can then either run a <strong>Single</strong> run, or a <strong>Bulk</strong> run:</p>
<ul class="simple">
<li><p>A <strong>single run</strong> will run with the current point cloud you have generated, you only need to select the number of sampling points in the subvolume region.</p></li>
<li><p>If you select to run in <strong>bulk</strong>, this will generate multiple point clouds and perform runs on them, instead of your current point cloud. You can set the minimum and maximum subvolume size you would like, and the size of the step between these values, and similar for the sampling points. In the example above, this would perform runs on point clouds with sizes 30, 40 and 50, and number of sampling points 9000, 9500 and 10000, so 9 runs in total. Note that the other settings for the point clouds generated will be taken from what you selected on the point cloud panel, including the subvolume shape, dimensionality, overlaps and rotation angles.</p></li>
</ul>
<p>For every run, any point clouds and input files to the DVC analysis code that are generated are saved in the session files, which you are able to access if you export your session (see <a class="reference internal" href="saving.html#exporting-sessions"><span class="std std-ref">Exporting Sessions</span></a>).</p>
<div class="section" id="run-progress">
<h3>Run Progress<a class="headerlink" href="#run-progress" title="Permalink to this headline">¶</a></h3>
<p>Whilst the DVC analysis is running, you will see updates on its progress, as below:</p>
<img alt="_images/run_progress_bar.png" src="_images/run_progress_bar.png" />
<p>The 1/8 on the first line indicates that it is on run 1 out of a total of 8 runs, and then on the next line it shows it is on point 26 out of a total of 191 for this run.
Following this we have:</p>
<ul>
<li><p><strong>[x,y,z] location</strong> of the point.</p></li>
<li><p>The search status:</p>
<p><strong>Point_Good</strong> = successful search convergence within the max displacement.</p>
<p><strong>Range_Fail</strong> = max displacement exceeded; consider increasing the disp_max parameter.</p>
<p><strong>Convg_Fail</strong> = maximum iterations exceeded; consider increasing subvol_size &amp;/or npts.</p>
</li>
<li><p>The <strong>magnitude of the objective function value</strong> at the end of the search is listed as obj=</p>
<p>For <code class="docutils literal notranslate"><span class="pre">obj_function</span> <span class="pre">=</span> <span class="pre">sad,</span> <span class="pre">ssd,</span> <span class="pre">and</span> <span class="pre">zssd</span></code> the value is relative, depending on subvolume size and pixel values.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">obj_function</span> <span class="pre">=</span> <span class="pre">nssd</span> <span class="pre">and</span> <span class="pre">znssd</span></code> the value is scaled between 0 and 2, with zero a perfect match.</p>
</li>
<li><p>The point <strong>[x,y,z] displacement</strong> is listed next for successful searches.</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="saving.html" class="btn btn-neutral float-right" title="Saving &amp; Exporting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="viewer.html" class="btn btn-neutral float-left" title="Datasets &amp; Visualisation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, UKRI STFC.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>